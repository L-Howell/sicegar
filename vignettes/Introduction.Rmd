---
title: Introduction
author: "Umut Caglar"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
  
# Introduction

This is the main function that puts everything in the package together; the aim of the package is to decide if a given time intensity data can be modelled with a sigmoidal curve or a double sigmoidal curve. The double sigmoidal curve is composed of 2 sigmoidal curves. First one increases from 0 to maximum intensity and second one decreases from maximum intensity to final asymptote intensity. After calculating the best candidate curves for both of the models the algorithm decides which of the two candidates (if any) is a better fit to the given data. After making the decision between the models, function gives parameters that quantify the time - intensity data with respect to the decided model. 

For sigmoidal model, some important ones of those parameters are: 

* maximum: the maximum intensity the sigmoidal model reach
* midpoint: where the sigmoidal curve reaches half of its maximum intensity
* slope: the maximum slope of the sigmoidal curve.

For double sigmoidal model, some important ones of those parameters are:

* maximum: the maximum intensity the double sigmoidal model reach
* final asymptote intensity: the intensity the model reaches at the end of decreasing part
* midpoint1: where the sigmoidal curve reaches half of its maximum intensity in the climbing regime
* slope1: The slope of the double sigmoidal model at midpoin1
* midpoint2: where the sigmoidal curve reaches the intensity in the middle of maximum intensity and final asymptote intensity
* slope2: The slope of the double sigmoidal model at midpoin2

The algorithm first used to quantify single cell viral infections. The data was generated from the fluorescence microscopy of single cell viral infections. The modified viral particles have an additional green fluorescence protein genes on them so during the infection the host also generates green fluorescence proteins which can be detected by a fluorescence microscope. From the microscope images, we generate intensity time data corresponding to infection, and the package was used to characterize the infection.

the input of main fit function is raw time - intensity data; after multiple steps the function returns an output composed of five distinct objects

* `.$normalizedInput`: Normalized dataset with normalization parameters in order to generate the raw dataset from normalized one. 
* `.$sigmoidalModel`: The parameters for sigmoidal fit.
* `.$doubleSigmoidalModel`: The parameters for double sigmoidal fit.
* `.$outputCluster`: The two fits compete with each other and the algorithm decides best model that represents the data. The detailed results of individual steps from competition process is in the outputCluster.
* `.$summaryVector`: the most important parameters of the winner model

In order to demonstrate how the function work; one needs to generate some synthetic time intensity data;


## Generate Synthetic Time - Intensity Data
```{r install packages, echo=FALSE, warning=FALSE, results='hide',message=FALSE}

###*****************************
# INITIAL COMMANDS TO RESET THE SYSTEM
rm(list = ls())
if (is.integer(dev.list())){dev.off()}
cat("\014")
seedNo=14159
set.seed(seedNo)
###*****************************

###*****************************
require("sicegar")
require("dplyr")
require("ggplot2")
require("cowplot")
###*****************************
```


To calculate the fits and generate the figures, firstly one needs to generate some synthetic data to analyze. To add some randomness to the input data I will use some noise. The input of the fit function must be in the form of a data frame with 2 columns time and intensity. 

We will generate data from both sigmoidal and double sigmoidal models with some arbitrarily chosen parameters:

Generate data based on sigmoidal model
```{r generate data for sigmoidal}
time=seq(3,24,0.5)

#simulate intensity data and add noise
noise_parameter=0.1
intensity_noise=stats::runif(n = length(time),min = 0,max = 1)*noise_parameter
intensity=sicegar::sigmoidalFitFormula(time, maximum=4, slopeParam=1, midPoint=8)
intensity=intensity+intensity_noise

dataInputSigmoidal=data.frame(intensity=intensity,time=time)
```


Generate data based on double - sigmoidal model
```{r generate data for double - sigmoidal}
noise_parameter=0.2
intensity_noise=runif(n = length(time),min = 0,max = 1)*noise_parameter
intensity = sicegar::doublesigmoidalFitFormula(time,
                                    finalAsymptoteIntensityRatio=.3,
                                    maximum=4,
                                    slope1Param=1,
                                    midPoint1Param=7,
                                    slope2Param=1,
                                    midPointDistanceParam=8)
intensity=intensity+intensity_noise
dataInputDoubleSigmoidal=data.frame(intensity=intensity,time=time)
```


## Apply the main function to obtain fit results

```{r apply fitFunction for sigmoidal & double_sigmoidal datasets}
# Here is how the input data looks like
head(dataInputSigmoidal)
head(dataInputDoubleSigmoidal)

fitObj_sm <- sicegar::fitFunction(dataInput = dataInputSigmoidal)
fitObj_dsm <- sicegar::fitFunction(dataInput = dataInputDoubleSigmoidal)
```

Although we use the defaults here; there are three thresholds one needs to determine before using the package; `threshold_minimum_for_intensity_maximum`, `threshold_intensity_range`,  and `threshold_t0_max_int`. Those parameters depend on the data source and measurement device, and details can be found in categorize_vignette. 

## Results

As mentioned above results of the fit function composes of five elements

* Details of the `.$normalizedInput` can be found in "sigmoidal_vignette" and "double_sigmoidal_vignette"
* Details of the `.$sigmoidalModel` can be found in "sigmoidal_vignette" , "multipleFit_vignette" and "parameterCalculation_vignette"
* Details of the `.$doubleSigmoidalModel` can be found in "double_sigmoidal_vignette" , "multipleFit_vignette" and "parameterCalculation_vignette"
* Details of the `.$outputCluster` can be found in "categorize_vignette"
* `.$summaryVector` includes all important parameters related with the decided model. 

### The results of the sigmoidal fit


```{r The results of the sigmoidal fit}

# The output composes of five elements
print(names(fitObj_sm))

# Summary of the results
utils::str(fitObj_sm$summaryVector)
```


### The results of the double_sigmoidal fit

```{r The results of the double_sigmoidal fit}

# The output composes of five elements
print(names(fitObj_dsm))

# Summary of the results
utils::str(fitObj_dsm$summaryVector)
```

## Generate figures

The figures of two synthetic datasets and corresponding model fits are generated by `sicegar::figureModelCurves`. In addition to the raw data and the decided model, the figures also emphasize important parameters that characterize decided models.


```{r cowplor figure, echo=TRUE, message=FALSE, warning=FALSE, comment=FALSE, fig.height=4, fig.width=8}
fig_a=sicegar::figureModelCurves(dataInput=fitObj_sm$normalizedInput,
                                  sigmoidalFitVector=fitObj_sm$sigmoidalModel,
                                  showParameterRelatedLines=TRUE)

# Double Sigmoidal Fit with parameter related lines
fig_b=sicegar::figureModelCurves(dataInput=fitObj_dsm$normalizedInput,
                                  doubleSigmoidalFitVector=fitObj_dsm$doubleSigmoidalModel,
                                  showParameterRelatedLines=TRUE)

fig <- cowplot::plot_grid(fig_a, fig_b, ncol = 2)
print(fig)
```
